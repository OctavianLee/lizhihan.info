title: RESTful设计实践
date: 2015-08-15 00:02:23
tags: [RESTful, Http, 设计架构]
categories: 设计架构
---

# RESTful简介
在接触互联网开发的时候，便涉及到了RESTful设计风格的概念。

REST这个词，是作为HTTP协议主要设计者Roy Thomas Fielding在他2000年的博士论文中提出的。中文翻译为表现层状态转化。

## 设计特色
这种风格设计出来人的API能够最大限度地利用HTTP本身的特性。正是由于这种特色，RESTful才会被广泛的推荐和应用。

## 设计差异
但是RESTful基于的设计原则，本身没有一套统一的设计标准，因此在理解和利用HTTP协议上，不同人存在着不同的差异。

# RESTful 实际考量

由于RESTful设计上存在差异，在实际中会碰到一些选择上的问题，这里罗列几种比较常遇到的问题的好的实践。

当然也因为没有严格的标准，所以也可以不必完全遵照。

## 数据格式

在实现RESTful需要考虑到的一个问题便是传输格式问题， 毕竟REST(Representational State Transfer)主要解决的表现层（Representation Layout）的状态转移。

主流的两种数据格式有json和xml，基于资源利用效率的考量，json以解析速度快和占用空间少，成为了主流，因此现在觉多数RESTful API是使用json来传输的。

当然yaml效率会更好一点，但是实际使用还没有普及，不过可以做一些有益的尝试。

## 错误返回码
有时候在对请求作为响应有问题的时候，需要通过错误返回码来确认响应的结果。

通常会有两种做法：

+ 为了最大程度的利用HTTP协议，返回码即通过HTTP的返回码来说明；
+ 自定义返回码值，在Json文本里，用一个特定的键来进行设置。

比较好的方式是对请求发起方的错误，用HTTP400系列的错误来作为返回码，而服务器本身处理错误，则在用HTTP500系列的错误返回的同时，在文本里加入自定义的错误码。


## POST/PUT
在RESTful设计里，会利用Http本身的Method来说明本次请求URL的含义。

在这些方法里，POST/PUT作用有些类似，通常的区分为：当创建新的资源的时候使用POST请求来进行，当对数据进行更新操作，则使用PUT的方式来进行请求。


## 自定义元信息
Http协议内容包含了Header和Body两个部分。

通常Header里包含了整个数据的一些基本的信息，或者说是元信息(meta)。而Body里则是写入资源本身的数据。

### 场景

在实际使用中会经常遇到自定义资源数据元信息的情况，譬如在做列表返回时，需要添加分页信息：

+ 作为分页返回，列表本身便是数据资源；
+ 分页包含的总个数等，只是分页数据的一些基本的信息或者说是元信息。

在做法上鉴于对RESTful的使用理解不同，对于这些非原生的元信息(即自定义元信息)通常会有两种做法：

+ 将自定义元信息写入Header，格式参照HTTP协议建议用大写X加上特定信息的形式；
+ 将自定义元信息写在Json数据里，用诸如"meta"等标签作为获取这些元信息的键。

### 实践建议

对于这类方式没有比较好的权威性质的建议，目前个人的建议是：如果包含较少的内容，可以写入Header中；如果包含了很多大量的信息，可以通过定义元信息写进Body中。

譬如在分页的场景下：

如果只需要总数和当前页，那么可以在Header里加入:

```
X-Total-Counts: xxxx
X-Current-Page: xx
```

如果需要更多内容，可以在Body的数据里，这样写：

```json
"metadata": {
   "current_page": xx,
   "per_page": xx,
   "total_counts": xxxx,
   "Links": [
       {"self": "/xxx?page=x&limit=xx"},
       {"first": "/xxx?page=x&limit=xx"},
       ...
      ]
}
```

此外在前后端分离且跨域场合下，对于写入Header的头信息，需要设置```Access-Control-Expose-Headers```参数来使这些头部信息能够可见可被获取。

***

版本修改记录：

+ 2015-08-15 完成本次文章全部内容。 By Octavian
