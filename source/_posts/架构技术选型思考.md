title: 架构技术选型的看法
date: 2016-04-04 22:40:01
tags: [设计架构, 技术选型]
categories: 设计架构
---

一晃一年过去了，好久没有更新文章了，姑且写点内容，这次不写干货，就谈谈以前一个亲身经历过的事以及看法。

# 引子

话说一年变的飞快，去年还是一名普通程序员，在年末的时候就带一个团队。角色的改变，确实让我有些不适应，原来单纯的开发视角不得不兼顾团队管理、沟通、技术架构等多方面的东西。

从最初做一个系统，到现在卓眼于服务化以及平台化，确实勉勉强强设计了不少东西，也踩了不少的坑。

记得最初设计系统的时候，还和曾经公司的老大唏嘘说了自己第一次做，感觉很厉害的样子。结果过去的老大问了我大概用了哪些技术栈，听完回答后，只是默默地说后端能搞东西就那么多。

确实，虽然互联网飞速发展，追求高可用、高并发、高性能，说到底到基础设施上无非离不开哪些耳熟能详的东西：Mysql/PostgreSql, Redis/Memcache, MQ etc。这么看多么厉害的系统也就那个样子，有一段时间我也是认为东西就那么多。

可是问题究竟是不是这样？

# 技术选型选择

如果不谈具体实现而言，在设计系统的时候，你要了DB、Redis和MQ总没有错，而且光靠这些东西确实能满足很多系统设计的需要。于是你就会陷入一个怪圈，对这些技术的使用信心越足，并越来越不敢尝试这个范畴以外的技术。理由是，不熟悉，不知道里面有多少坑，用自己熟悉的踏实一点。

渐渐地，你越来越熟悉这些东西，也就越来越依赖。这也就是当打开互联网招聘需求了，都是Mysql、Redis什么的，敢与众不同的实在太少了。

或许你可能和我说，现实情况下，公司规模越大，用户量越大，如果不想有什么语不惊人死不休的设计，最好在选型上保守，这样保证服务稳定。这当然也没有错，但是即使是这些保守的Redis、Mysql还是存在因为用的方式方法问题造成很多问题，选的东西是熟悉的保守的，但是造成的局面还是那么糟糕也错过很多更优的解。

在技术选型上，如果不谈实际，我更喜欢按照场景来。如果大量集数据的column不固定的且读取场景很多，为什么不用HBase非要在Mysql上调整设计。如果不是为了使用Redis特有的数据结构，为何不尝试一下memcache，如果实时性确实不是特别特别高，可以试一下ssdb似乎数据还不会丢失。当然上面说的我都最终没用过，不过不久之前，只是在某个特别的场景下，用了mongo。

其实技术选型的选择很多，技术选型可以不用圈死自己。有时候不是就那么多，只是敢选的就那么多。

# 技术选型使用

很多情况下，事实上这个才是现实，我还是选择了Redis、Mysql，确实我就是这么保守的人，我只想做东西出来，保证业务。毕竟我的产品经理要排期，业务方等上线，等我熟悉了这些技术，早就响应不了需求，这时候，我的boss就会给我毙了。

是的，乍一看，无非就这些东西，但如何用也就成了架构设计上一个重要的环节。单纯的数据缓存和数据落地，你无非考虑的也就是注意不要对Redis过分的依赖，如何设计表结构，查询甚至拆分表库等。这么看所谓的设计无非也就是做这么底层的东西罢了。

但是实际上这些稀松平常的东西，往往适当的组合能产生特别的效果。

拿不久前的事举个例子吧，总所周知，MQ有几个主要的作用，解耦系统，消息分发那些。但是之前有一个设计需要有一个优先级队列（具体场景不透露），每一个数据需要根据优先级大小排序。这显然不符合队列的特征（先进先出），而Redis的zset是做这个的良将。但是原生的MQ即使是broker用Redis，支持的也是list，因为可以控制阻塞等原因，总不能黑科技意义mock成zset吧，如果光用zset放弃MQ就轮询了？于是就结合zset和list做了一个这样的队列，解决了实际问题。

东西无非也就是Redis，但是适当的设计就能有特别的作用。当然你还是要考虑，Redis集群下你想要的阻塞特性没有办法使用，只能单机的问题（什么，没有用过集群？我之前参与面试过很多人，不少人用过Redis但很多只是单机）。设计毕竟有优缺点了，看你怎么取舍这件事了。

是的，技术选型东西确实也就那么多东西，但是那么多东西能用好就是了不起的事。超量数据如何选择纬度分表分库，如何保证缓存与主从一致性等等，虽然还是那么多东西，但是却是一个很深的东西。在上层再结合诡异的需求等等，其实不止那么多东西。

# 结尾

这个故事其实还是那个道理，不要眼高手低，只有用过的人才知道里面的坑。了解和熟悉还是不同的，印象比较深的，之前有一个面试者，我问了map、filter、reduce的作用，之前的面试者都是讲了用法都是概念性的，但是这个人还把这三个东西等价函数写了出来，说明了确实看过理解过。

最近又有新的系统要设计了，这次感觉要做一些没试过的东西啊，心里还是有点慌的，还是好好了解一下用的技术选型吧～～



***

版本修改记录：

+ 2016-04-05 完成文章全部内容。 By Octavian